\documentclass{article}

\usepackage{amsmath}
\usepackage{amssymb}

\usepackage[backend=biber,style=numeric]{biblatex}
\addbibresource{refs.bib}
\title{Simplified Climate Simulation}
\author{
    Felix Hellborg,
    Rasmus Pernesten
    \\
    \textbf{Handledare: Erik Swietlicki}
}
\date{
    \textbf{\date}
}
\begin{document}
  \maketitle


  \begin{abstract}
Climate change is one of the biggest challenges of modern times, posing a threat comparable to that of nuclear war. Enormous resources are therefore allocated to preventing and mitigating the consequences of global warming. To tackle this issue effectively-and to avoid spending time and resources on ineffective measures-climate models are developed. With the aim of understanding how such a model can be constructed and what difficulties arise in the process, we have created a highly simplified climate simulation using programming and mathematical modelling to compute different aspects of a climate system..
This model does not aim to predict exact measurements, but rather to reproduce real-world phenomena.
Our goal with the model was to observe effects such as dayâ€“night cycles, seasonal variations, colder poles, and a warmer equator. Although the model failed to reproduce all of these features, it is thermally stable, and it clearly shows notable differences between day and night, summer and winter, as well as between equatorial and polar regions.
 \end{abstract}
  
  \section{Simulation}
  The simulation built during this project is written in Rust using the Bevy game engine.
  
  \subsection{Units}
  For the purposes of this project, the units of measurements are not the regular SI-units. Because we're interested in the trends, and the relationships between parameters and outcomes, the values of the simulation parameters have been set such that they yield interesting and realistic results with respect to internal consistency (within the units of measurements we're using, whatever they may be).

  When in the course of reading this report, the reader comes across the usage of distance units [D.U.] or temperature units [T.U.], they should be imagined as corresponding to meters [m] and Kelvin [K] respectively with some arbitrary scaling factor. Note that temperature will always be given in an absolute scale (i.e. starting at zero).

  The visual representation should not be thought of as having a realistic scale. The size of a planet with respect to the distance to its host star is so small as to be impossible to see in a realistic relative scale. The same thing is true for the relative difference in size between the planet and the host star itself (the diameter ratio between the earth and the sun is roughly 110:1 \cite{wikisun}).
  
  \section{Solar System}
  The solar system model used in the simulation is a simplified model of our own solar system, consisting of only one planet. The parameters of the planet's orbit can be set arbitrarily, including period time $T$, time at perihelion $\tau_p$, eccentricity $e$. The planet's motion relative to the star (always located at the origin) adheres to Kepler's laws of planetary motion:
  $$x = a(\cos E - e)$$
  $$y = b\sin E = a \sqrt{1-e^2} \sin E$$
  where $a$ is the semi-major axis, $b$ is the semi-minor axis, and the eccentric anomaly $E$ is related to the mean anomaly $M$ by
  $$M = E - e\sin E$$
  where
  $$M \equiv n(t-\tau_p).$$
  
  Here, n denotes the average rate of sweep
  $$n \equiv \frac{2\pi}{T},$$
  and $t$ is the time in arbitrary units since start.

  The exact solution to the eccentric anomaly $E(t)$ lacks a general closed form, it is usually expressed as a Fourier series. For the purposes of this simulation, the exact solution is irrelevant, and there happens to be a very good numerical approximation for $E(t)$ developed by Seppo Mikkola in 1987. While the details of this method are beyond the scope of this paper, the method is presented in Appendix \ref{Mikkola}.
  
  \section{Heat Equation}

  The heat equation on a flat cartesian plane can be written as \cite{wikiheat}
  $$
    \partial_t T = \kappa\nabla^2 T = \kappa(\partial^2_{xx} T + \partial^2_{yy} T)
  $$
  where $\nabla^2$ denotes the Laplacian. In section \ref{sphere-coords}, we will generalize the heat equation further to be defined on a spherical surface using the Laplace-Beltrami operator. For now, however, we will use the simplest possible geometry to discuss how we can simulate heat diffusion in a discrete system.

  \subsection{Runge-Kutta Methods}
  Assuming we have discretesized the map into a heat matrix T at some time $t$, we can solve for T at time (t+h) using a system of RK4 calculations \cite{originalkutta} \cite{wikikutta}.

  Given an equation
  \begin{equation}
    \frac{dA}{dt} = F(A, t)
  \end{equation}
  where $A$ is a matrix and $F$ is a linear function in the basis of $A$, and an initial value of $A(t)$, we get

  \begin{equation}
    A(t+h) \approx \frac{h}{6}(k_1+k_2+k_3+k_4)
    \label{eq:rk4}
  \end{equation}
  where
  \begin{equation}
    k_1 = F(A(t)),
    \label{eq:k1}
  \end{equation}
  
  \begin{equation}
    k_2 = F(A(t) + \frac{h}{2}k_1),
    \label{eq:k2}
  \end{equation}
  
  \begin{equation}
    k_3 = F(A(t) + \frac{h}{2}k_2),
    \label{eq:k3}
  \end{equation}
  
  \begin{equation}
    k_4 = F(A(t) + hk_3).
    \label{eq:k4}
  \end{equation}
  The approximation given by RK4 perform significantly better than the familiar Euler method, especially at larger time-steps, allowing us to run the simulation at higher speeds.

  Note that for partial differential equations, we must also discretesize (approximate) derivatives as follows:

  \begin{equation}
    \partial^2_{x^ix^i} a_{ij} \approx \frac{-a_{i(j+1)} + 2a_{ij} - a_{i(j-1)}}{(\Delta x)^2}
  \end{equation}

  Here, $\partial^2_{x^kx^k} a_{ij}$ denotes the second derivative of element $a_{ij}$ with respect to coordinate $x^k$.

  

  \subsection{Spherical Coordinates}\label{sphere-coords}
  In the beginning of this chapter, we wrote the heat equation using the Laplacian $\nabla^2$, which works for geometries lacking any curvature where the metric tensor $g_{\mu\nu}$ is defined on the flat-space $\mathbb{R}^2$ Reimann manifold where the interval is
  $$ds^2 = dx^2 + dy^2.$$

  In general, we define the metric tensor on a manifold through the interval
  $$ds^2 = g_{\mu\nu}dx^\mu dx^\nu.$$
  (Note the usage of the Einstein summation convention.)

  The heat equation then becomes
  \begin{equation}
    \partial_t T = \kappa \Delta_g T
    \label{eq:General-Heat-Eq}
  \end{equation}
  where $\Delta_g$ denotes the Laplace-Beltrami operator which, when applied to some scalar function $f$, yields \cite{wikilaplace}
  \begin{equation}
    \Delta_g f = \frac{1}{\sqrt{|g|}} \partial_i(\sqrt{|g|}g^{ij}\partial_j f).
    \label{eq:Laplace-Beltrami}
  \end{equation}
  Here, $|g|$ is the absolute value of the determinant of the metric tensor. Again, note the usage of the Einstein summation convention.
  
  In our flat case:
  $$ g_{\mu\nu} =
  \begin{pmatrix}
    1 & 0\\
    0 & 1
  \end{pmatrix}
  $$
  and $|g|$ is $1$. Thus, we can calculate $\Delta_g f$ from equation \ref{eq:Laplace-Beltrami} as
  
  $$\Delta_g f = \partial^2_{x^1x^1} f + \partial^2_{x^2x^2} f$$
  or in cartesian coordinates
  
  $$\Delta_g f = \partial^2_{xx} f + \partial^2_{yy} f.$$

  We're interested in the $S^2$ Riemann manifold where 

  $$g = 
  \begin{pmatrix}
    R^2 & 0 \\
    0 & R^2\sin^2{\theta}
  \end{pmatrix}.
  $$
  Because
  $$g_{ij} = 0 \quad \forall \quad i \neq j$$
  we find
  $$|g| = R^4\sin^2{\theta} \Rightarrow \sqrt{|g|} = R^2\sin{\theta} \quad \forall \quad \theta \in [0, \pi]$$
  and
  $$g^{ii} = \frac{1}{g_{ii}}.$$
  
  From equation \ref{eq:Laplace-Beltrami}, we find 

  $$\Delta_{S^2}f = \frac{1}{R^2\sin{\theta}}(\partial_\theta(R^2\sin{\theta}(g^{\theta\theta}\partial_\theta f)) + (\partial_\phi R^2\sin{\theta}(g^{\phi\phi}\partial_\phi f))).$$
  Here, we've used the fact that $g^{\theta\phi}=g^{\phi\theta}=0$ to simplify the expression. We now substitute our values for $g^{\theta\theta}$ and $g^{\phi\phi}$ to find
  $$\Delta_{S^2}f = \frac{1}{R^2}(\cot{\theta}\partial_\theta f + \partial^2_{\theta\theta} f + \frac{1}{\sin^2{\theta}}\partial^2_{\phi\phi} f).$$
  
  Now, we can rewrite equation \ref{eq:General-Heat-Eq} as
  $$\partial_t T = \kappa \frac{1}{R^2}(\cot{\theta}\partial_\theta T + \partial^2_{\theta\theta} T + \frac{1}{\sin^2{\theta}}\partial^2_{\phi\phi} T)$$
  which we discretesize using
  $$\partial_{x^k} T_{ij} \approx \frac{T_{ij}-T_{i(j-1)}}{\Delta x^k}$$
  $$\partial^2_{x^kx^k} T_{ij} \approx \frac{-T_{(i+1)j} + 2T_{ij} - T_{(i-1)j}}{(\Delta x^k)^2}$$
  for coordinate $x^k$.

  \newpage
  \appendix
  \section{Mikkola's Approximation}\label{Mikkola}
  Here follows the full calculation by which the eccentric anomaly $E(t)$ can be approximated using Mikkola's method. This paper only presents the elliptical case and does not provide any proof or explanation to any of these steps. The curious reader is referred to the original paper \cite{mikkola}.

  \subsection{Formula}
  Assuming the value of the mean anomaly $M(t)$ is known, Kepler's equation can (in the elliptical case) be rewritten as
  
  $$E(t) = M(t) + e(3s-4s^3)$$
  where
  $$s \equiv \sin{E(t)/3}.$$

  The trick lies in approximating $s$, which can be done by setting
  $$\alpha \equiv (1-e)/(4e+\frac{1}{2})$$
  and
  $$\beta \equiv \frac{1}{2}M/(4e+\frac{1}{2}).$$

  Now let
  $$z = (\beta \pm \sqrt{\beta^2+\alpha^3})^{1/3},$$
  choosing the sign of the root term to match the sign of $\beta$.
  
  We can, by means of a series expansion approximate $s$ by
  $$s \approx z - \frac{\alpha}{z}.$$

  Note that $M$ should be chosen as to be in the range $(-\pi, \pi]$ such that it is as close as possible to $0$, thus yielding the least error from the series expansion.

  \newpage
  \printbibliography
\end{document}
